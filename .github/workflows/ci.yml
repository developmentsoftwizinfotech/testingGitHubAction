name: Docker Image CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [14.x, 16.x, 18.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/

    steps:
    - uses: actions/checkout@v3
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    - run: npm i    
    - run: npm ci
    - run: npm run build --if-present
    - uses: mr-smithers-excellent/docker-build-push@v5
    - name: Build & push Docker image  
    - uses: actions/checkout@v3
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag my-image-name:$(date +%s)
  

# name: Project cicd flow
# on:

#   push:
#     branches: [ master ]
#     pull_request:
#     branches: [ master ]


# # jobs:
# #   build:
# #     runs-on: ubuntu-latest
#     jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       -  run: echo Test One Worked!

#         # node-version: letests

#     steps:
#    - name: Checkout
#       uses: actions/checkout@v3

#     - name: Setup Node.js
#       uses: actions/setup-node@v3
#       with:
#         node-version: 18

#     - name: Install dependencies
#       run: npm install

#     - name: Build
#       run: npm run build:prod
#   - name: Build & push Docker image
#      uses: mr-smithers-excellent/docker-build-push@v5
#     with:
#       image: neeleshkv/angular-istcosa-image
#       tags: latest
#       registry: docker.io
#       dockerfile: Dockerfile
#       username: ${{ secrets.DOCKER_USERNAME }}
#       password: ${{ secrets.DOCKER_PASSWORD }}



        # uses: ncipollo/release-action@v3
        # with:
        #   artifacts: "dist/testing-docker/index.html*"
        #   token: ${{ secrets.TOKEN }}


        #   name: GitHub Pages

# - name: Build and push Docker images
  # uses: docker/build-push-action@v4.0.0









  # - uses: mr-smithers-excellent/docker-build-push@v5
  #   name: Build & push Docker image
  #   with:
  #     image: repo/image
  #     tags: v1, latest
  #     registry: registry-url.io
  #     dockerfile: Dockerfile.ci
  #     username: ${{ secrets.DOCKER_USERNAME }}
  #     password: ${{ secrets.DOCKER_PASSWORD }}



# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     steps:
#     - name: Checkout
#       uses: actions/checkout@v3

#     - name: Setup Node.js
#       uses: actions/setup-node@v3
#       with:
#         node-version: 18

#     - name: Install dependencies
#       run: npm install

#     - name: Build
#       run: npm run build:prod
#     - name: Deploy
#       with:
#         github_token: ${{ secrets.GITHUB_TOKEN }}
#         publish_dir: dist/angular-github-actions


